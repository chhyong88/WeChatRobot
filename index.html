<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>微信公众账号机器人--超人</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>微信机器人</h1>
        <h2>PHP制作的简单微信机器人自动回复程序</h2>
        <a href="https://github.com/MyGHCode/WeChatRobot" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span class="octicon octicon-link"></span></a>代码介绍：</h3>

<p>应用程序核心PHP代码如下:</p>

<pre><code>
	define("TOKEN", "superman");

	$wechatObj = new wechatCallbackapiTest();
	if (!isset($_GET['echostr'])) {
		$wechatObj->responseMsg();
	}else{
		$wechatObj->valid();
	}

	class wechatCallbackapiTest
	{
	//验证签名
	public function valid()
	{
		$echoStr = $_GET["echostr"];
		$signature = $_GET["signature"];
		$timestamp = $_GET["timestamp"];
		$nonce = $_GET["nonce"];
		$token = TOKEN;
		$tmpArr = array($token, $timestamp, $nonce);
		sort($tmpArr);
		$tmpStr = implode($tmpArr);
		$tmpStr = sha1($tmpStr);
		if($tmpStr == $signature){
			echo $echoStr;
			exit;
		}
	}

	//响应消息
	public function responseMsg()
	{
		$postStr = $GLOBALS["HTTP_RAW_POST_DATA"];
		if (!empty($postStr)){
			$this->logger("R ".$postStr);
			$postObj = simplexml_load_string($postStr, 'SimpleXMLElement', LIBXML_NOCDATA);
			$RX_TYPE = trim($postObj->MsgType);
			 
			//消息类型
			switch ($RX_TYPE)
			{
				case "event":
					$result = $this->receiveEvent($postObj);
					break;
				case "text":
					$result = $this->receiveText($postObj);
					break;
				case "image":
					$result = $this->receiveImage($postObj);
					break;
				case "location":
					$result = $this->receiveLocation($postObj);
					break;
				case "voice":
					$result = $this->receiveVoice($postObj);
					break;
				case "video":
					$result = $this->receiveVideo($postObj);
					break;
				case "link":
					$result = $this->receiveLink($postObj);
					break;
				default:
					$result = "unknown msg type: ".$RX_TYPE;
					break;
			}
			$this->logger("T ".$result);
			echo $result;
		}else {
			echo "";
			exit;
		}
	}

   

</code></pre>

<p>修改代码中define("TOKEN", "superman");  改为您喜欢的Token名.在微信开发者中心配置的时候需要用到.</p>

<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>配置介绍：</h3>

<p><img src="images/step.png"></p>

<h3>
<a id="rather-drive-stick" class="anchor" href="#rather-drive-stick" aria-hidden="true"><span class="octicon octicon-link"></span></a>功能介绍：</h3>

<p>可以识别多种关键字,可以查询城市天气,许多功能用户可以自己探索.
<br/>
输入 help 的提示信息如下：
<br/>
<code>
发送 城市名天气 获取城市天气,<br/>
如：发送 北京天气 获取城市北京的天气.<br/>
<br/>
发送 help 可以获得帮助.<br/>
发送 img 可看到网站预览图.<br/>
发送 news 可看图片新闻.<br/>
发送 music 可听音乐.<br/>
<br/>
当然也可以发送其他关键字来查看是否能获得您想要的信息.<br/>
您还可以给我发语音,位置,图片等.</code> </p>
<br/>
<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>效果截图：</h3>

<p>
<img src="images/demo.png" /><br/>
<img src="images/demo1.png" />
</p>

<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>关于这段小程序</h3>

<p>利用业余时间,自己学习PHP,参考官方文档,参考网上代码自己制作的.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/MyGHCode/WeChatRobot/zipball/master" class="button">
            <small>下载</small>
            .zip 文件
          </a>
          <a href="https://github.com/MyGHCode/WeChatRobot/tarball/master" class="button">
            <small>下载</small>
            .tar.gz 文件
          </a>
			
			<p><img src="images/weixin.jpg" /></p>

          <p class="repo-owner"><a href="https://github.com/MyGHCode/WeChatRobot"></a> 作者 <a href="https://about.79kg.com">黄广志</a>.</p>

          <p>这是我的域名 <a href="https://79kg.com">79kg.com</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
